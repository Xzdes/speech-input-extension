# Расширение "Smart Voice Input" для Chrome (v2.3)

**Smart Voice Input** — это мощное расширение для браузера Chrome, предназначенное для интеллектуального голосового ввода текста. Оно позволяет не только диктовать текст в любые поля ввода на веб-страницах, но и использовать продвинутые функции, такие как автозамена, команды форматирования, опциональный перевод через Gemini API, и инновационный генератор промптов для улучшения ваших запросов к языковым моделям. Расширение оснащено информативным индикатором состояния и системой уведомлений для максимального удобства пользователя.

## Ключевые Возможности

*   **Интеллектуальный Голосовой Ввод**: Преобразует речь в текст с использованием `webkitSpeechRecognition API` и вставляет его в активное текстовое поле. Поддерживает отображение промежуточных результатов ("стенография") для мгновенной обратной связи.
*   **Многоязычная Поддержка**: Выбор языка распознавания из широкого списка.
*   **Управление Активностью**: Простое включение/выключение диктовки через иконку расширения.
*   **Информативный Индикатор Состояния**:
    *   Иконка расширения динамически изменяется, отражая статус (включено, выключено, ошибка).
    *   Контекстный индикатор на странице отображает текущее действие: `Слушаю...`, `Обработка...`, `Перевод...`, `Идеи для промпта...`, а также информирует о возможных проблемах (`Сайт в черном списке`, `Нет доступа к микрофону` и т.д.).
*   **Генератор Промптов с AI**:
    *   Специальный режим для надиктовки идей, которые затем отправляются в Gemini API для преобразования в качественный, структурированный промпт.
    *   Возможность автоматической вставки сгенерированного промпта в активное поле или его копирования.
*   **Перевод Текста (через Gemini API)**:
    *   Опциональный перевод распознанного текста на другой язык перед вставкой.
    *   Требует пользовательский **Gemini API ключ**.
*   **Продвинутая Кастомизация**:
    *   **Автозамена**: Настройка пользовательских правил для замены фраз (например, "запятая" -> ","). Поставляется с предзаполненным списком для пунктуации.
    *   **Команды Форматирования**: Голосовые команды "новая строка", "удалить слово", "удалить всё" и т.д.
    *   **Отключение Авто-пунктуации Браузера**: Опция для полного контроля над знаками препинания через голосовые команды.
    *   **Черный список сайтов**: Исключение сайтов, где расширение не должно работать.
    *   **Выбор модели Gemini**: Возможность выбора стандартных моделей Gemini или указания своей.
*   **Уведомления**: Информирование пользователя о критических проблемах, например, об отсутствии доступа к микрофону.
*   **Работа в iframe**: Благодаря настройке `all_frames` в манифесте, расширение стремится работать и во встроенных фреймах на страницах.

## Установка

### Для разработчиков (установка из исходного кода):

1.  Клонируйте репозиторий или скачайте ZIP-архив с кодом и распакуйте его.
2.  Откройте браузер Chrome и перейдите на страницу `chrome://extensions`.
3.  Включите "Режим разработчика" (Developer mode).
4.  Нажмите "Загрузить распакованное расширение" (Load unpacked) и выберите папку с кодом расширения.

### Для пользователей (после публикации в Chrome Web Store):

*   [Ссылка будет добавлена после публикации]

## Использование

1.  **Первоначальная Настройка**:
    *   Для использования функций **Перевода** и **Генератора Промптов** необходим Gemini API ключ. Получите его на [Google AI Studio](https://aistudio.google.com/app/apikey).
    *   Кликните по иконке расширения, чтобы открыть настройки. Вставьте ваш API ключ, выберите модель Gemini.
    *   Настройте языки, автозамену, черный список и другие опции по вашему усмотрению.

2.  **Основная Диктовка**:
    *   Убедитесь, что опция "Включить диктовку" активна.
    *   Кликните в текстовое поле на веб-странице. Индикатор состояния покажет `Слушаю...`.
    *   Начните говорить. Текст будет появляться по мере распознавания (стенография), а затем финализироваться.
    *   Если включен перевод, текст будет переведен перед финальной вставкой (индикатор покажет `Перевод...`).

3.  **Режим "Генерация Промпта"**:
    *   В настройках включите "Режим 'Генерация Промпта'". Индикатор изменится на `Идеи для промпта...` при фокусе на поле.
    *   Надиктуйте ваши идеи, ключевые слова, описание задачи. Текст не будет вставляться в поле, а будет накапливаться для отправки в AI.
    *   Когда вы закончите (например, сделаете паузу, уберете фокус с поля или выключите режим), накопленный текст будет отправлен в Gemini для создания улучшенного промпта.
    *   Сгенерированный промпт появится в специальном поле в окне настроек расширения. Его можно скопировать.
    *   Если включена опция "Вставлять промпт в поле при фокусе", сгенерированный промпт будет автоматически вставлен в текстовое поле на текущей вкладке, которое вы выберете следующим.

4.  **Уведомления**: Расширение уведомит вас, если не сможет работать (например, нет доступа к микрофону или сайт в черном списке) через индикатор на странице или системные уведомления Chrome.

## Структура проекта

*   `manifest.json`: Конфигурация расширения.
*   `background.js`: Service Worker для фоновых задач (API вызовы, управление иконкой).
*   `content.js`: Основной скрипт, работающий на веб-страницах.
*   `popup/`: Файлы для окна настроек (`popup.html`, `popup.js`).
*   `icons/`: Иконки расширения.

## Возможные проблемы

*   **Дублирование или "заедание" текста**: Хотя были приложены значительные усилия для стабилизации, на некоторых сайтах или при определенных условиях могут возникать проблемы с отображением `interimResults` или их заменой на финальный текст.
*   **Работа в сложных веб-приложениях**: Сайты с интенсивным использованием JavaScript-фреймворков или Shadow DOM могут представлять сложности для корректного определения активного поля и вставки текста. Функция `triggerInputEvents` старается это минимизировать.
*   **Задержки при переводе / генерации промптов**: Скорость этих операций зависит от ответа Gemini API и вашего интернет-соединения.