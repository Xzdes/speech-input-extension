# Расширение "Голосовой Ввод Pro" для Chrome (v2.0)

Усовершенствованное расширение для браузера Chrome, позволяющее вводить текст голосом в любое активное текстовое поле на веб-странице. Включает поддержку горячих клавиш, черного списка сайтов, автозамены, команд форматирования и опционального перевода текста через Gemini API.

## Возможности

*   **Голосовой ввод**: Автоматически преобразует речь с микрофона в текст и вставляет его в поле ввода, находящееся в фокусе.
*   **Поддержка нескольких языков**: Пользователь может выбрать язык распознавания речи из списка (например, Русский, Английский, Немецкий и др.).
*   **Управление состоянием**:
    *   Легкое включение и выключение функции диктовки через иконку расширения.
    *   **Горячая клавиша**: Быстрое включение/выключение диктовки (по умолчанию `Ctrl+Shift+S` или `Cmd+Shift+S` на Mac), настраивается в `chrome://extensions/shortcuts`.
*   **Визуальная индикация**:
    *   Иконка расширения меняет свой вид в зависимости от того, включена или выключена функция.
    *   Активное поле ввода подсвечивается контуром при фокусе.
    *   Рамка поля ввода меняет цвет во время записи речи (зеленый - запись, оранжевый - промежуточный результат, синий - перевод, красный - ошибка).
*   **Сохранение настроек**: Все настройки сохраняются между сессиями браузера.
*   **Автозамена**: Пользователь может определить свои правила для автоматической замены фраз на символы или другие слова (например, "запятая" -> ",").
*   **Команды форматирования**: Поддержка голосовых команд для базового форматирования, таких как "новая строка", "удалить слово", "удалить всё".
*   **Черный список сайтов**: Возможность указать сайты, на которых расширение не будет автоматически активироваться.
*   **Перевод текста (через Gemini API)**:
    *   Опциональная функция перевода распознанного текста на другой язык перед вставкой.
    *   Требует от пользователя ввода собственного **Gemini API ключа**.
    *   Поддерживается выбор целевого языка перевода и модели Gemini.

## Установка

### Для разработчиков (установка из исходного кода):

1.  Клонируйте этот репозиторий или скачайте ZIP-архив с кодом и распакуйте его.
    ```bash
    git clone [URL_ВАШЕГО_РЕПОЗИТОРИЯ] speech-input-pro
    cd speech-input-pro
    ```
2.  Откройте браузер Chrome и перейдите на страницу `chrome://extensions`.
3.  Включите "Режим разработчика" (Developer mode) в правом верхнем углу.
4.  Нажмите кнопку "Загрузить распакованное расширение" (Load unpacked).
5.  Выберите папку с кодом расширения (например, `speech-input-pro`).
6.  Расширение будет установлено и готово к использованию. Иконка появится на панели расширений Chrome.

### Для пользователей (после публикации в Chrome Web Store):

*   [Ссылка на страницу расширения в Chrome Web Store - будет добавлена после публикации]

## Использование

1.  **Начальная настройка (для функции перевода)**:
    *   Если вы планируете использовать функцию перевода, получите свой Gemini API ключ на [Google AI Studio](https://aistudio.google.com/app/apikey).
    *   Откройте настройки расширения (клик по иконке), перейдите в раздел "Перевод (через Gemini API)", вставьте свой ключ в поле "Ваш Gemini API Ключ" и включите опцию "Включить перевод". Выберите язык перевода и модель.

2.  **Включение/Выключение диктовки**:
    *   **Через Popup**: Нажмите на иконку расширения. Во всплывающем окне установите или снимите галочку "Включить диктовку".
    *   **Горячей клавишей**: Используйте назначенную комбинацию (по умолчанию `Ctrl+Shift+S` / `Cmd+Shift+S`).

3.  **Выбор языка распознавания**:
    *   Во всплывающем окне расширения выберите желаемый язык из выпадающего списка "Язык распознавания:".

4.  **Настройка автозамены**:
    *   В разделе "Автозамена" введите правила в формате `фраза для замены : чем заменить` (каждое правило на новой строке). Например: `точка с запятой : ;`. Используйте `\n` для вставки символа новой строки.

5.  **Настройка черного списка**:
    *   В разделе "Черный список сайтов" введите домены или части URL (каждый на новой строке), где расширение не должно работать. Например: `youtube.com`.

6.  **Голосовой ввод текста**:
    *   Убедитесь, что функция диктовки включена и текущий сайт не в черном списке.
    *   Кликните на любое текстовое поле на веб-странице.
    *   При первой активации на сайте браузер запросит разрешение на использование микрофона. Нажмите "Разрешить".
    *   Начните говорить. Ваша речь будет автоматически преобразовываться в текст.
    *   Если включен перевод, текст сначала будет переведен, а затем вставлен.
    *   Правила автозамены будут применены перед переводом или вставкой.
    *   Используйте команды форматирования (например, скажите "новая строка").
    *   Во время активной записи поле ввода будет подсвечено рамкой, цвет которой будет меняться в зависимости от состояния.
    *   Для прекращения ввода уберите фокус с поля ввода, выключите диктовку или используйте горячую клавишу.

## Структура проекта

*   `manifest.json`: Основной конфигурационный файл расширения.
*   `background.js`: Service Worker для фоновых задач (управление состоянием иконки, инициализация настроек, обработка команд).
*   `content.js`: Скрипт, внедряемый на веб-страницы для отслеживания фокуса, управления распознаванием речи, автозаменой, переводом и вставкой текста.
*   `popup/`: Папка с файлами для всплывающего окна настроек.
    *   `popup.html`: HTML-структура всплывающего окна.
    *   `popup.js`: JavaScript-логика для всплывающего окна.
*   `icons/`: Папка с иконками расширения для различных состояний и размеров.

## Возможные проблемы и их решения

*   **Голосовой ввод не работает**:
    1.  Убедитесь, что вы дали разрешение на использование микрофона для текущего сайта.
    2.  Проверьте, включена ли функция диктовки в настройках расширения или горячей клавишей.
    3.  Убедитесь, что текущий сайт не добавлен в черный список.
    4.  Проверьте, выбран ли правильный язык распознавания.
    5.  Убедитесь, что ваш микрофон подключен, включен и корректно настроен в операционной системе.
    6.  Попробуйте перезагрузить страницу или браузер.
*   **Перевод не работает**:
    1.  Убедитесь, что опция "Включить перевод" активна в настройках.
    2.  Проверьте, что вы ввели корректный Gemini API ключ.
    3.  Проверьте ваше интернет-соединение, так как перевод требует обращения к внешнему API.
    4.  Проверьте консоль разработчика (F12 -> Console) на наличие ошибок от Gemini API. Возможно, ваш ключ недействителен, исчерпаны лимиты или промпт заблокирован по соображениям безопасности.
*   **Ошибка "Could not establish connection. Receiving end does not exist." в консоли `popup.js` или `background.js`**:
    *   Эта ошибка может появляться, если всплывающее окно открывается или фоновый скрипт пытается отправить сообщение на страницы, где контент-скрипт не может быть внедрен (например, `chrome://extensions`, внутренняя страница ошибки браузера) или еще не успел загрузиться. Обычно это не влияет на основную работу расширения, так как состояние синхронизируется через хранилище.
*   **Горячая клавиша не работает**:
    *   Проверьте, какая комбинация назначена на странице `chrome://extensions/shortcuts`. Возможно, она конфликтует с другой горячей клавишей системы или другого расширения. Вы можете изменить ее там же.